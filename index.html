<body>
    <div style='display: flex; height: 100%; justify-content: center;'><canvas height='800' id='canvas' width='800' /></div>
    <script>
        let arena = {
            color: 'black',
            pxLen: 20,
            time: 66
        }
        let bot0 = {
            color: 'red',
            isEnabled: true,
            path: [],
            pos: [{ x: 200, y: 200 }],
            size: 4
        }
        let bot1 = undefined
        let bot2 = undefined
        let player = {
            color: 'green',
            currentKey: undefined,
            desiredKey: undefined,
            isEnabled: false,
            pos: [{ x: 600, y: 600 }],
            size: 4
        }
        let food = {
            color: 'cyan',
        }
        let walls = undefined
        let portals = undefined

        window.onload = () => {
            canvas = document.getElementById('canvas')
            context = canvas.getContext('2d')
            setInterval(loop, arena.time)
            document.addEventListener('keydown', event => (player.desiredKey = event.key))
        }
        let loop = () => {
            context.fillStyle = arena.color
            context.fillRect(0, 0, canvas.width, canvas.height)

            if (bot0.isEnabled) {
                context.fillStyle = bot0.color
                bot0.pos.forEach(pos => context.fillRect(pos.x, pos.y, arena.pxLen, arena.pxLen))
                if (!bot0.path.length) {
                    bot0.path = bot0.path.concat([
                        { x: 300, y: 320},
                        { x: 300, y: 340},
                        { x: 280, y: 340},
                        { x: 260, y: 340},
                        { x: 260, y: 320},
                        { x: 260, y: 300},
                        { x: 280, y: 300},
                        { x: 300, y: 300}
                    ])
                }
                let x = bot0.pos[0]?.x
                let y = bot0.pos[0]?.y
                let pos = bot0.path.shift()
                x = pos?.x
                y = pos?.y
                bot0.pos.unshift({ x, y })
                while (bot0.size < bot0.pos.length) {
                    bot0.pos.pop()
                }
                bot0.pos.forEach((pos, i) => {
                    if (pos.x < 0 || canvas.width <= pos.x || pos.y < 0 || canvas.height <= pos.y || (i && pos.x === bot0.pos[0]?.x && pos.y === bot0.pos[0]?.y && bot0.path)) {
                        let bot0 = {
                            color: 'red',
                            isEnabled: true,
                            path: [],
                            pos: [{ x: 200, y: 200 }],
                            size: 4
                        }
                    }
                    if (pos.x === food.pos?.x && pos.y === food.pos?.y) {
                        bot0.size += 4
                        food.pos = undefined
                    }
                })
            }
            if (player.isEnabled) {
                context.fillStyle = player.color
                player.pos.forEach(pos => context.fillRect(pos.x, pos.y, arena.pxLen, arena.pxLen))
                if (player.desiredKey === 'ArrowUp' && player.currentKey !== 'ArrowDown') {
                    player.currentKey = player.desiredKey
                } else if (player.desiredKey === 'ArrowDown' && player.currentKey !== 'ArrowUp') {
                    player.currentKey = player.desiredKey
                } else if (player.desiredKey === 'ArrowLeft' && player.currentKey !== 'ArrowRight') {
                    player.currentKey = player.desiredKey
                } else if (player.desiredKey === 'ArrowRight' && player.currentKey !== 'ArrowLeft') {
                    player.currentKey = player.desiredKey
                }
                let x = player.pos[0]?.x
                let y = player.pos[0]?.y
                if (player.currentKey === 'ArrowUp') {
                    y -= arena.pxLen
                } else if (player.currentKey === 'ArrowDown') {
                    y += arena.pxLen
                } else if (player.currentKey === 'ArrowLeft') {
                    x -= arena.pxLen
                } else if (player.currentKey === 'ArrowRight') {
                    x += arena.pxLen
                }
                player.pos.unshift({ x, y })
                while (player.size < player.pos.length) {
                    player.pos.pop()
                }
                player.pos.forEach((pos, i) => {
                    if (pos.x < 0 || canvas.width <= pos.x || pos.y < 0 || canvas.height <= pos.y || (i && pos.x === player.pos[0]?.x && pos.y === player.pos[0]?.y && player.currentKey)) {
                        player.pos = []
                    }
                    if (pos.x === food.pos?.x && pos.y === food.pos?.y) {
                        player.size += 4
                        food.pos = undefined
                    }
                })
            }

            context.fillStyle = food.color
            context.fillRect(food.pos?.x, food.pos?.y, arena.pxLen, arena.pxLen)
            if (!food.pos) {
                food.pos = {
                    x: Math.floor(Math.random() * canvas.width / arena.pxLen) * arena.pxLen,
                    y: Math.floor(Math.random() * canvas.height / arena.pxLen) * arena.pxLen
                }
            }
        }
    </script>
</body>
